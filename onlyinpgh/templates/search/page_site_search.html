{% extends 'page.html' %}

{% block main-content %}
{% load thumbnail %}
<article class="page-content" id="search-results-page">
    <h2>Search</h2>

    <form method="get" action="{% url site-search %}" class="simple-form">
        
            {{ form.q }}
        
            <input type="submit" value="Search">
        </form>
        {% if query %}
            {% if results %}
            <section class="results-type row-container">
                <h3>Places</h3>
                {% if results.places %}
                    <ul class="feed">
                        {% for result in results.places|slice:"0:6" %}
                        <li class="item">
                            <a href="{{result.object.get_absolute_url}}">
                            {% thumbnail result.object.image "50x50" crop="center" as im %}
                            <img class="thumbnail" alt="{{result.object.name}}" src="{{im.url}}" />
                            {% empty %}
                            <img class="thumbnail" alt="{{result.object.name}}" src="/static/img/default-place.png" />
                            {% endthumbnail %}
                            <h4 class="item-title">{{result.object.name}}</h4>
                            <p>{{result.object.location.address}}</p>
                            {% include "tags/tag_list.html" with tags=result.object.tags %}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                    <div class="see-more-thumbs">
                        {% for result in results.places|slice:"5:16" %}
                            <a href="{{result.object.get_absolute_url}}">
                                {% thumbnail result.object.image "50x50" crop="center" as im %}
                                <img alt="{{result.object.name}}" src="{{im.url}}" />
                                {% empty %}
                                <img alt="{{result.object.name}}" src="/static/img/default-place.png" />
                                {% endthumbnail %}
                            </a>
                        {% endfor %}
                        <div><a href="{% url places-feed %}?q={{query}}" title="See more places...">See all...</a></div>
                    </div>
                {% else %}
                <p class="none-found">None found.</p>
                {% endif %}
            </section>

            <section class="results-type">
                <h3>Events</h3>
                {% if results.events %}
                <ul class="feed">
                {% for result in results.events %}
                    <li class="result">
                        <h4 class="item-title"><a href="{{result.object.get_absolute_url}}">{{result.object.name}}</a></h4>
                        <p>{{result.object.dtstart|date:"N j, f a"}} - {{result.object.dtend|date:"f a"}}</p>
                        <p>at {{result.object.place.name}}</p>
                    </li>
                {% endfor %}
                </ul>
                <a class="right" href="{% url events-feed %}?q={{query}}" title="See more events...">See all...</a>
                {% else %}
                <p class="none-found">None found.</p>
                {% endif %}

            </section>
            <section class="results-type">
                <h3>Specials</h3>
                {% if results.specials %}
                <ul class="feed">
                {% for result in results.specials %}
                    <li class="results">
                        <h4 class="item-title"><a href="{{result.object.get_absolute_url}}">{{result.object.title}}</a></h4>
                        <p>at {{result.object.place.name}}</p>
                    </li>
                {% endfor %}
                </ul>
                <a class="right" href="{% url specials-feed %}?q={{query}}" title="See more specials...">See all...</a>
                {% else %}
                <p class="none-found">None found.</p>
                {% endif %}
            </section>
            <section class="results-type">
                <h3>News</h3>
                {% if results.news_articles %}
                <ul class="feed news">
                {% for result in results.news_articles %}
                    <li class="result">
                        <h4 class="item-title"><a href="{{result.object.fulltext_url}}">{{result.object.title}}</a></h4>
                        <ul class="item-details">
                            <li>Source: <a href="{{result.object.source_site}}">{{result.object.source_name}}</a></li>
                            <li>{{result.object.publication_date}}</li>
                            <li class="blurb">{{result.object.blurb|truncatewords:20}} <a href="{{result.object.fulltext_url}}">See full article</a></li>
                        </ul>
                    </li>
                {% endfor %}
                </ul>
                <a href="{% url news-feed %}?q={{query}}" class="right" title="See more news...">See all...</a>
                {% else %}
                <p class="none-found">None found.</p>
                {% endif %}
            </section>
            <section class="results-type">
                <h3>Chatter</h3>
                {% if results.chatter_posts %}
                <ul class="feed">
                {% for result in results.chatter_posts %}
                    <li class="item">{{result.object.content}}</li>
                {% endfor %}
                </ul>
                <a class="right" href="{%url chatter-feed%}?q={{query}}" title="See more posts...">
                {% else %}
                <p>None found.</p>
                {% endif %}
            </section>

            {% else %}  {# no results #}
            <p class="none-found">No results!</p>
            {% endif %}

        {% else %}
            {# Show some example queries to run, maybe query syntax, something else? #}
        {% endif %}
</article>
{% endblock %}

{% block sidebar %}
{% include "sidebar/sidebar_search.html" %}
{% endblock %}