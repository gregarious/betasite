{% extends "page.html" %}

{% comment %}
Page-based template for the Places feed

Context variables:
    [items]: List of PlaceContext instances
    items_json: JSON string of PlaceFeedResources corresponding to [items]
    prev_p: page number of previous page (if available)
    next_p: page number of next page (if available)        
{% endcomment %}

{% block main-content %}
<header class="feed-header">
    <h1 class="feed-title">Places</h1>
    <form class="filter">
        <input type="search" placeholder="Filter Places" />
        <input type="submit" value="Filter" />
    </form>
</header>

<article class="feed-content">
    <div class="map-container" id="mainPlaceFeedMap"></div>
    {% if prev_p %}<a href="{% url places-feed %}?p={{prev_p}}">Previous</a> | {% endif %}
    {% if next_p %}<a href="{% url places-feed %}?p={{next_p}}">Next</a>{% endif %}

    <ul class="feed places" id="mainPlaceFeed">
        {# will be inserted via Backbone bootstrapping below #}
    </ul>
    {% comment %}
    Old code where server writes feed. Being replaced with bootstrapped-Backbone below
    {% for item in items %}
        <li class="item {%if item.place.location.is_geocoded%}hasMarker{%endif%}">
        {% include "places/feed_item.html" with place=item %}
        </li>
    {% endfor %}
    {% endcomment %}
    </ul>

    {% if prev_p %}<a href="{% url places-feed %}?p={{prev_p}}">Previous</a> | {% endif %}
    {% if next_p %}<a href="{% url places-feed %}?p={{next_p}}">Next</a>{% endif %}
</article> <!-- .feed-content -->
{% endblock %}

{% block sidebar %}
{% include "places/sidebar_place_feed.html" %}
{% endblock %}

{% block foot-inlines %}
<script type="text/javascript">
$(function(){
    // model extensions not strictly necessary: defaults will do for Places
    var PlaceItem = scenable.mapFeed.Item.extend();
    var PlaceItems = scenable.mapFeed.ItemFeed.extend({model:PlaceItem});

    var PlaceView = scenable.mapFeed.ItemView.extend({
        template: window.TPL.placeInfoWindow,
        iwTemplate: window.TPL.placeInfoWindow,
        markerOptions: {
            icon: '/static/img/markers/place-marker.png',
            shadow: '/static/img/markers/marker-shadow.png'
        }
    });
    var PlaceFeed = scenable.mapFeed.FeedView.extend({SubViewClass:PlaceView});

    var Items = new PlaceItems;
    var Feed = new PlaceFeed({
        model: Items,
        el: document.getElementById('mainPlaceFeed'),
        mapDOMElement: document.getElementById('mainPlaceFeedMap'),
        mapOptions: {
            center: new google.maps.LatLng(40.44417, -79.94583),
            zoom: 14,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            panControl: false,
            mapTypeControl: false,
            streetViewControl: false,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL
            }
        }
    });

    var bootstrapData = {{items_json|default:"[]"}};
    Items.reset(bootstrapData);
});
</script>
{% endblock %}